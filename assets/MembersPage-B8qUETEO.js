import{l as P,r as d,w as $,o as D,e as q,k as A,q as t,g as I,t as v,h as i,z as V,Q as y,y as w,I as C}from"./index-C-xpmZAv.js";import{Q as N}from"./QInput-CDY8LMS6.js";import{Q as B}from"./QTooltip-DgCstHqf.js";import{Q as S}from"./QBtnGroup-DDshPcgs.js";import{Q as z,a as M}from"./QTable-D3PU5TAi.js";import{Q as T}from"./QPage-Bc7DMt7Q.js";import{u as Y}from"./use-quasar-Cq90yekB.js";import{d as j}from"./date-CYNLjyfE.js";import"./use-id-Beu2uHRI.js";import"./use-timeout-C9dFF4FH.js";import"./use-dark-C2GkM102.js";import"./private.use-form-C2pDNVHz.js";import"./QSeparator-Ddswcuea.js";import"./QVirtualScroll-DnadSe4m.js";import"./QList-PkyEnzbd.js";import"./rtl-DFPa-2ov.js";import"./QChip-vCkVbOju.js";import"./QItem-8UxAzF0w.js";import"./QItemLabel-DFuciFK-.js";import"./QDialog-CtDY-7MH.js";import"./use-prevent-scroll-uSPdFNBj.js";import"./format-dCatN8Gn.js";import"./use-fullscreen-BvG0t_7e.js";const x={class:"text-h5 q-mb-md"},de={__name:"MembersPage",setup(R){const{t:s}=P(),l=Y(),{apiAuth:u}=C(),p=d(!1),b=d([]),r=d(""),n=d({sortBy:"createdAt",descending:!0,page:1,rowsPerPage:15,rowsNumber:0}),Q=[{name:"username",label:s("admin.members.username"),field:"username",align:"left"},{name:"email",label:s("admin.members.email"),field:"email",align:"left"},{name:"status",label:s("admin.members.status"),field:e=>e.isBanned?"已封鎖":"正常",align:"left"},{name:"joinDate",label:s("admin.members.joinDate"),field:"createdAt",format:e=>j.formatDate(e,"YYYY/MM/DD"),align:"left"},{name:"actions",label:s("admin.members.actions"),field:"actions",align:"center"}],m=async e=>{console.log("載入會員資料:",e);const{page:a,rowsPerPage:o,sortBy:g,descending:k}=e.pagination;p.value=!0;try{const c={page:a,limit:o,sortBy:g,order:k?"desc":"asc",search:r.value};console.log("API 請求參數:",c);const{data:f}=await u.get("/api/users",{params:c});console.log("API 回應資料:",f),b.value=f.items,n.value.rowsNumber=f.total,n.value.page=a,n.value.rowsPerPage=o}catch(c){console.error("載入會員失敗:",c),l.notify({type:"negative",message:c.response?.data?.message||"載入失敗",position:"top"})}finally{p.value=!1}},_=async e=>{console.log("切換封鎖狀態:",e);try{await u.patch(`/api/users/${e.id}/ban`,{isBanned:!e.isBanned}),console.log("封鎖狀態更新成功"),await m({pagination:n.value}),l.notify({type:"positive",message:s(e.isBanned?"admin.members.unbanSuccess":"admin.members.banSuccess"),position:"top"})}catch(a){console.error("封鎖狀態更新失敗:",a),l.notify({type:"negative",message:a.response?.data?.message||"操作失敗",position:"top"})}},h=e=>{console.log("準備刪除會員:",e),l.dialog({title:s("admin.members.delete"),message:s("admin.members.confirmDelete"),cancel:!0,persistent:!0}).onOk(async()=>{try{await u.delete(`/api/users/${e.id}`),console.log("會員刪除成功"),await m({pagination:n.value}),l.notify({type:"positive",message:s("admin.members.deleteSuccess"),position:"top"})}catch(a){console.error("會員刪除失敗:",a),l.notify({type:"negative",message:a.response?.data?.message||"刪除失敗",position:"top"})}})};return $(r,()=>{console.log("搜尋條件變更:",r.value),n.value.page=1,m({pagination:n.value})}),D(()=>{console.log("組件掛載，開始載入資料"),m({pagination:n.value})}),(e,a)=>(q(),A(T,{class:"q-pa-md"},{default:t(()=>[I("div",x,v(e.$t("admin.members.title")),1),i(M,{rows:b.value,columns:Q,"row-key":"id",loading:p.value,pagination:n.value,onRequest:m,filter:r.value,"virtual-scroll":"","virtual-scroll-slice-size":15,"virtual-scroll-item-size":48,"virtual-scroll-sticky-size-start":48},{"top-right":t(()=>[i(N,{borderless:"",dense:"",debounce:"300",modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=o=>r.value=o),placeholder:"搜尋"},{append:t(()=>[i(V,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":t(o=>[i(z,{props:o},{default:t(()=>[i(S,{flat:""},{default:t(()=>[i(y,{flat:"",round:"",color:o.row.isBanned?"positive":"negative",icon:o.row.isBanned?"how_to_reg":"block",onClick:g=>_(o.row)},{default:t(()=>[i(B,null,{default:t(()=>[w(v(o.row.isBanned?e.$t("admin.members.unban"):e.$t("admin.members.ban")),1)]),_:2},1024)]),_:2},1032,["color","icon","onClick"]),i(y,{flat:"",round:"",color:"negative",icon:"delete",onClick:g=>h(o.row)},{default:t(()=>[i(B,null,{default:t(()=>[w(v(e.$t("admin.members.delete")),1)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination","filter"])]),_:1}))}};export{de as default};
