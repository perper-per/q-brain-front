import{l as q,r as v,w as D,o as z,e as h,k as Q,q as a,g as A,t as c,h as n,z as S,y,Q as _,A as k,I as E}from"./index-BiNfTUt7.js";import{Q as I}from"./QInput-cRBVbv57.js";import{a as T}from"./QChip-CyJbEm7N.js";import{Q as C,a as Y}from"./QTable-FjsR4TqF.js";import{Q as b}from"./QTooltip-Sh7jJ5aX.js";import{Q as M}from"./QBtnGroup-8lrSYwxu.js";import{Q as x}from"./QPage-DaNz6j13.js";import{u as H}from"./use-quasar-Br_KVkHa.js";import{d as R}from"./date-GHPV1jZE.js";import"./use-id-CukJhIl1.js";import"./use-timeout-BPDyqdbG.js";import"./use-dark-CfkyhclR.js";import"./private.use-form-C2TTMn0v.js";import"./QSeparator-DJy09rsp.js";import"./QVirtualScroll-CLN3YUmd.js";import"./QList-DMjiVD7T.js";import"./rtl-DFPa-2ov.js";import"./QItem-CdWpSIge.js";import"./QItemLabel-Cq7rmHhz.js";import"./QDialog-DOy7Apx1.js";import"./use-prevent-scroll-CJfCjB8k.js";import"./format-dCatN8Gn.js";import"./use-fullscreen-B8IJGb1-.js";const G={class:"text-h5 q-mb-md"},fe={__name:"CommentsPage",setup(O){const{t:i}=q(),r=H(),{apiAuth:p}=E(),w=v(!1),d=v([]),m=v(""),s=v({sortBy:"createdAt",descending:!0,page:1,rowsPerPage:15,rowsNumber:0}),$=[{name:"author",label:i("admin.comments.author"),field:e=>e.author.username,align:"left"},{name:"content",label:i("admin.comments.content"),field:"content",align:"left"},{name:"date",label:i("admin.comments.date"),field:"createdAt",format:e=>R.formatDate(e,"YYYY/MM/DD HH:mm"),align:"left",sortable:!0},{name:"status",label:i("admin.comments.status"),field:"status",align:"left"},{name:"actions",label:i("admin.comments.actions"),field:"actions",align:"center"}],P=e=>({pending:"warning",approved:"positive",rejected:"negative"})[e]||"grey",l=async e=>{const{page:t,rowsPerPage:o,sortBy:u,descending:j}=e.pagination;w.value=!0;try{const g={page:t,limit:o,sortBy:u,order:j?"desc":"asc",search:m.value},{data:f}=await p.get("/api/comments",{params:g});f&&f.items?(d.value=f.items,s.value.rowsNumber=f.total||0):(d.value=[],s.value.rowsNumber=0),s.value.page=t,s.value.rowsPerPage=o}catch(g){console.error("Error loading comments:",g),d.value=[],r.notify({type:"negative",message:g.response?.data?.message||"載入失敗",position:"top"})}finally{w.value=!1}},B=async e=>{try{await p.patch(`/api/comments/${e.id}/approve`),await l({pagination:s.value}),r.notify({type:"positive",message:i("admin.comments.approveSuccess"),position:"top"})}catch(t){console.error("Error approving comment:",t),r.notify({type:"negative",message:t.response?.data?.message||"審核失敗",position:"top"})}},N=async e=>{try{await p.patch(`/api/comments/${e.id}/reject`),await l({pagination:s.value}),r.notify({type:"positive",message:i("admin.comments.rejectSuccess"),position:"top"})}catch(t){console.error("Error rejecting comment:",t),r.notify({type:"negative",message:t.response?.data?.message||"拒絕失敗",position:"top"})}},V=e=>{r.dialog({title:i("admin.comments.delete"),message:i("admin.comments.confirmDelete"),cancel:!0,persistent:!0}).onOk(async()=>{try{await p.delete(`/api/comments/${e.id}`),await l({pagination:s.value}),r.notify({type:"positive",message:i("admin.comments.deleteSuccess"),position:"top"})}catch(t){console.error("Error deleting comment:",t),r.notify({type:"negative",message:t.response?.data?.message||"刪除失敗",position:"top"})}})};return D(m,()=>{s.value.page=1,l({pagination:s.value})}),z(()=>{l({pagination:s.value})}),(e,t)=>(h(),Q(x,{class:"q-pa-md"},{default:a(()=>[A("div",G,c(e.$t("admin.comments.title")),1),n(Y,{rows:d.value,columns:$,"row-key":"id",loading:w.value,pagination:s.value,onRequest:l,filter:m.value,"virtual-scroll":"","virtual-scroll-slice-size":15,"virtual-scroll-item-size":48,"virtual-scroll-sticky-size-start":48},{"top-right":a(()=>[n(I,{borderless:"",dense:"",debounce:"300",modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=o=>m.value=o),placeholder:"搜尋"},{append:a(()=>[n(S,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-status":a(o=>[n(C,{props:o},{default:a(()=>[n(T,{color:P(o.row.status),"text-color":"white",size:"sm"},{default:a(()=>[y(c(e.$t(`admin.comments.statuses.${o.row.status}`)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-actions":a(o=>[n(C,{props:o},{default:a(()=>[n(M,{flat:""},{default:a(()=>[o.row.status==="pending"?(h(),Q(_,{key:0,flat:"",round:"",color:"positive",icon:"check",onClick:u=>B(o.row)},{default:a(()=>[n(b,null,{default:a(()=>[y(c(e.$t("admin.comments.approve")),1)]),_:1})]),_:2},1032,["onClick"])):k("",!0),o.row.status==="pending"?(h(),Q(_,{key:1,flat:"",round:"",color:"negative",icon:"close",onClick:u=>N(o.row)},{default:a(()=>[n(b,null,{default:a(()=>[y(c(e.$t("admin.comments.reject")),1)]),_:1})]),_:2},1032,["onClick"])):k("",!0),n(_,{flat:"",round:"",color:"negative",icon:"delete",onClick:u=>V(o.row)},{default:a(()=>[n(b,null,{default:a(()=>[y(c(e.$t("admin.comments.delete")),1)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination","filter"])]),_:1}))}};export{fe as default};
