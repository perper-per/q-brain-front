import{k as P,r as d,w as $,o as D,d as A,j as V,p as t,f as q,t as v,g as i,y as C,Q as y,x as w}from"./index-SI6qLy-A.js";import{Q as I}from"./QInput-CC8Y3-te.js";import{Q as B}from"./QTooltip-Yrvls0-S.js";import{Q as N}from"./QBtnGroup-CYg5W5u0.js";import{Q as S,a as M}from"./QTable-BoBWf31W.js";import{Q as T}from"./QPage-D5YUbjOZ.js";import{u as Y}from"./use-quasar-B5v10Q4Z.js";import{d as j}from"./date-DPfCy5YO.js";import{u as x}from"./axios-DllUqyUS.js";import"./use-id-C99lgWk1.js";import"./use-timeout-BZQ2vAIR.js";import"./use-dark-BKy0ugTk.js";import"./private.use-form-OAohUWXl.js";import"./QSeparator-r8BsFOFB.js";import"./QVirtualScroll-DlZSW2Ad.js";import"./QList-B9ltZJgu.js";import"./rtl-DFPa-2ov.js";import"./QChip-CaGSQLfL.js";import"./QItem-BZVsuFZI.js";import"./QItemLabel-Dz5dwcfF.js";import"./QDialog-Cvzv8fR2.js";import"./use-prevent-scroll-BQUGPH1N.js";import"./format-dCatN8Gn.js";import"./use-fullscreen-CI59ERI4.js";const z={class:"text-h5 q-mb-md"},ue={__name:"MembersPage",setup(R){const{t:s}=P(),l=Y(),{apiAuth:u}=x(),p=d(!1),b=d([]),r=d(""),n=d({sortBy:"createdAt",descending:!0,page:1,rowsPerPage:15,rowsNumber:0}),Q=[{name:"username",label:s("admin.members.username"),field:"username",align:"left"},{name:"email",label:s("admin.members.email"),field:"email",align:"left"},{name:"status",label:s("admin.members.status"),field:e=>e.isBanned?"已封鎖":"正常",align:"left"},{name:"joinDate",label:s("admin.members.joinDate"),field:"createdAt",format:e=>j.formatDate(e,"YYYY/MM/DD"),align:"left"},{name:"actions",label:s("admin.members.actions"),field:"actions",align:"center"}],m=async e=>{console.log("載入會員資料:",e);const{page:a,rowsPerPage:o,sortBy:g,descending:k}=e.pagination;p.value=!0;try{const c={page:a,limit:o,sortBy:g,order:k?"desc":"asc",search:r.value};console.log("API 請求參數:",c);const{data:f}=await u.get("/api/users",{params:c});console.log("API 回應資料:",f),b.value=f.items,n.value.rowsNumber=f.total,n.value.page=a,n.value.rowsPerPage=o}catch(c){console.error("載入會員失敗:",c),l.notify({type:"negative",message:c.response?.data?.message||"載入失敗",position:"top"})}finally{p.value=!1}},_=async e=>{console.log("切換封鎖狀態:",e);try{await u.patch(`/api/users/${e.id}/ban`,{isBanned:!e.isBanned}),console.log("封鎖狀態更新成功"),await m({pagination:n.value}),l.notify({type:"positive",message:s(e.isBanned?"admin.members.unbanSuccess":"admin.members.banSuccess"),position:"top"})}catch(a){console.error("封鎖狀態更新失敗:",a),l.notify({type:"negative",message:a.response?.data?.message||"操作失敗",position:"top"})}},h=e=>{console.log("準備刪除會員:",e),l.dialog({title:s("admin.members.delete"),message:s("admin.members.confirmDelete"),cancel:!0,persistent:!0}).onOk(async()=>{try{await u.delete(`/api/users/${e.id}`),console.log("會員刪除成功"),await m({pagination:n.value}),l.notify({type:"positive",message:s("admin.members.deleteSuccess"),position:"top"})}catch(a){console.error("會員刪除失敗:",a),l.notify({type:"negative",message:a.response?.data?.message||"刪除失敗",position:"top"})}})};return $(r,()=>{console.log("搜尋條件變更:",r.value),n.value.page=1,m({pagination:n.value})}),D(()=>{console.log("組件掛載，開始載入資料"),m({pagination:n.value})}),(e,a)=>(A(),V(T,{class:"q-pa-md"},{default:t(()=>[q("div",z,v(e.$t("admin.members.title")),1),i(M,{rows:b.value,columns:Q,"row-key":"id",loading:p.value,pagination:n.value,onRequest:m,filter:r.value,"virtual-scroll":"","virtual-scroll-slice-size":15,"virtual-scroll-item-size":48,"virtual-scroll-sticky-size-start":48},{"top-right":t(()=>[i(I,{borderless:"",dense:"",debounce:"300",modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=o=>r.value=o),placeholder:"搜尋"},{append:t(()=>[i(C,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":t(o=>[i(S,{props:o},{default:t(()=>[i(N,{flat:""},{default:t(()=>[i(y,{flat:"",round:"",color:o.row.isBanned?"positive":"negative",icon:o.row.isBanned?"how_to_reg":"block",onClick:g=>_(o.row)},{default:t(()=>[i(B,null,{default:t(()=>[w(v(o.row.isBanned?e.$t("admin.members.unban"):e.$t("admin.members.ban")),1)]),_:2},1024)]),_:2},1032,["color","icon","onClick"]),i(y,{flat:"",round:"",color:"negative",icon:"delete",onClick:g=>h(o.row)},{default:t(()=>[i(B,null,{default:t(()=>[w(v(e.$t("admin.members.delete")),1)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination","filter"])]),_:1}))}};export{ue as default};
